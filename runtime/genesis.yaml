name: "Open Soul Genesis"
description: "Initialize the Open Soul Protocol environment and inject a specific soul seed."

# ğŸ› ï¸ è¾“å…¥å‚æ•°ï¼šå…è®¸ç”¨æˆ·æŒ‡å®šç§å­
inputs:
  seed_url:
    type: string
    description: "The raw URL of the Soul Seed YAML to install."
    # é»˜è®¤ä½¿ç”¨"ç©ºç™½ç§"
    default: "https://raw.githubusercontent.com/open-soul/seeds/main/tabula_rasa.yaml"

steps:
  # === 1. ç¯å¢ƒå‡†å¤‡ (Scaffold) ===
  # åˆ›å»ºå¿…è¦çš„ç›®å½•ç»“æ„ (OpenClaw çš„ fs.write é€šå¸¸ä¼šè‡ªåŠ¨åˆ›å»ºçˆ¶ç›®å½•ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†ä¿é™©)
  - id: log_start
    uses: log:info
    with:
      message: "Starting Genesis Protocol... Targeting Seed: {{ inputs.seed_url }}"

  # === 2. ä¸‹è½½æ ¸å¿ƒç»„ä»¶ (Download Runtime) ===
  # ä» Open Soul å®˜æ–¹ä»“åº“æ‹‰å–æœ€æ–°çš„è§£é‡Šå™¨å’Œè¿›åŒ–å™¨
  
  # [A] ä¸‹è½½ render.md (è§£é‡Šå™¨)
  - id: fetch_render
    uses: http:get
    with:
      url: "https://raw.githubusercontent.com/open-soul/runtime/main/render.md"
  - id: install_render
    uses: fs:write
    with:
      path: "./soul/render.md"
      content: "{{ steps.fetch_render.body }}"

  # [B] ä¸‹è½½ reflection.md (è¿›åŒ–é€»è¾‘)
  - id: fetch_reflection
    uses: http:get
    with:
      url: "https://raw.githubusercontent.com/open-soul/runtime/main/reflection.md"
  - id: install_reflection
    uses: fs:write
    with:
      path: "./workflows/reflection.md"
      content: "{{ steps.fetch_reflection.body }}"

  # [C] ä¸‹è½½ evolution.yaml (å®šæ—¶ä»»åŠ¡)
  - id: fetch_evolution
    uses: http:get
    with:
      url: "https://raw.githubusercontent.com/open-soul/runtime/main/evolution.yaml"
  - id: install_evolution
    uses: fs:write
    with:
      path: "./workflows/evolution.yaml"
      content: "{{ steps.fetch_evolution.body }}"

  # === 3. æ³¨å…¥çµé­‚ç§å­ (Inject Seed) ===
  # ä¸‹è½½ç”¨æˆ·æŒ‡å®šçš„ç§å­æ–‡ä»¶
  - id: fetch_seed
    uses: http:get
    with:
      url: "{{ inputs.seed_url }}"
  - id: install_seed
    uses: fs:write
    with:
      path: "./soul/active_soul.yaml"
      content: "{{ steps.fetch_seed.body }}"

  # === 4. åˆå§‹åŒ–è®°å¿† (Init Memory) ===
  # åˆ›å»ºç©ºçš„æ—¥å¿—æ–‡ä»¶ï¼Œé˜²æ­¢ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶è¯»å–æŠ¥é”™
  - id: init_logs
    uses: fs:write
    with:
      path: "./memory/daily_logs.md"
      content: "System initialized via Genesis Protocol. Awaiting input."

  # === 5. è§‰é†’ä»ªå¼ (The Awakening) ===
  # è®© Agent è¯»å–æ–°ä¸‹è½½çš„çµé­‚ï¼Œå¹¶å‘ç”¨æˆ·è‡ªæˆ‘ä»‹ç»
  # æ³¨æ„ï¼šæ­¤æ—¶ Config å¯èƒ½è¿˜æ²¡æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰‹åŠ¨æŠŠ render.md æ³¨å…¥åˆ°è¿™æ¬¡ Prompt é‡Œ
  - id: awaken
    uses: llm:generate
    with:
      model: "gpt-4-turbo"
      prompt: |
        {{ steps.fetch_render.body }}
        
        SYSTEM ALERT: You have just been installed via the Genesis Protocol.
        Your soul file is located at ./soul/active_soul.yaml.
        
        TASK:
        1. Introduce yourself to the user based STRICTLY on your new Nucleus and Persona.
        2. Inform the user that installation is complete.
        3. REMINDER: Tell the user they must manually update their `config.yaml` to make this permanent.
        
        Output format: A welcoming message in character.

  # === 6. è¾“å‡ºç»“æœ ===
  - id: finish
    uses: log:info
    with:
      message: "Genesis Complete. Soul installed."
    
  - id: reply_user
    uses: conversation:reply
    with:
      content: "{{ steps.awaken.output }}"